<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Quiniela Liga MX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="‚öΩ Quiniela Liga MX - Participa Ahora">
  <meta property="og:description" content="Haz tus pron√≥sticos de la Liga MX. üèÜ Premio Mayor para m√°s aciertos. ü•à Premio Menor por marcadores exactos. ¬°2 pron√≥sticos por jugador!">
  <meta property="og:site_name" content="Quiniela Liga MX">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="‚öΩ Quiniela Liga MX - Participa Ahora">
  <meta name="twitter:description" content="Haz tus pron√≥sticos de la Liga MX. üèÜ Premio Mayor para m√°s aciertos. ü•à Premio Menor por marcadores exactos.">
  
  <!-- General Meta Tags -->
  <meta name="description" content="Quiniela Liga MX - Haz tus pron√≥sticos y compite por premios. Sistema de doble entrada con premio mayor y menor.">
  <meta name="keywords" content="quiniela, liga mx, futbol, pronosticos, predicciones">

  <style>
    :root{
      --bg:#0f1220;
      --card:#171a2f;
      --line:#2a2e52;
      --accent:#7c9cff;
      --ok:#35d49a;
      --bad:#ff6b6b;
      --txt:#e9ecff;
    }
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,#0c0f1d,#12152b);
      color:var(--txt);
    }
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:16px;
      margin-bottom:14px;
    }
    h1,h2,h3{margin:.2em 0 .6em 0}
    .small{opacity:.85;font-size:13px}
    input,select,button{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#0c0f1d;
      color:var(--txt);
      font-size:16px;
      box-sizing:border-box;
      -webkit-appearance:none;
      -moz-appearance:none;
      appearance:none;
      transition:all 0.2s ease;
    }
    input:focus,select:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(124,156,255,0.2);
    }
    input:disabled,select:disabled{
      opacity:0.6;
      cursor:not-allowed;
    }
    button{
      background:linear-gradient(180deg,#6f8cff,#5a74ff);
      border:none;
      font-weight:800;
      cursor:pointer;
      touch-action:manipulation; /* Prevents double-tap zoom on mobile */
    }
    button:active{
      transform:scale(0.98);
      opacity:0.9;
    }
    button:disabled{
      opacity:0.5;
      cursor:not-allowed;
    }
    button.secondary{
      background:#0c0f1d;
      border:1px solid var(--line);
      font-weight:700;
    }
    button.secondary:active{
      background:rgba(255,255,255,0.05);
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }
    th,td{
      padding:8px;
      border-bottom:1px solid var(--line);
      text-align:left;
    }
    th{
      opacity:.8;
      font-weight:700;
      position:sticky;
      top:0;
      background:var(--card);
      z-index:1;
    }
    td{
      vertical-align:middle;
    }
    /* Responsive table wrapper */
    .table-wrapper{
      overflow-x:auto;
      -webkit-overflow-scrolling:touch;
      margin:10px 0;
    }
    .center{text-align:center}
    .ok{color:var(--ok)}
    .bad{color:var(--bad)}

    /* Partido header */
    .matchHead{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; margin-bottom:10px;
    }
    .team{
      display:flex; align-items:center; gap:8px; min-width:0;
    }
    .team span{white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:220px;}
    .logo{
      width:26px; height:26px; border-radius:50%;
      background:#0c0f1d; border:1px solid var(--line);
      object-fit:contain;
    }
    .vs{opacity:.8; font-weight:800}

    /* ‚úÖ Dos picks lado a lado */
    .twoCols{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .miniCard{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background:rgba(255,255,255,.03);
    }
    .miniTitle{font-weight:900;margin-bottom:8px}
    .locked{
      opacity:.6;
      filter:grayscale(1);
    }
    
    /* ===== RESPONSIVE DESIGN ===== */
    
    /* Tablets and smaller desktops (768px - 1024px) */
    @media(max-width:1024px){
      .wrap{max-width:100%;padding:20px}
      h1{font-size:1.8em}
      h2{font-size:1.5em}
    }
    
    /* Tablets (700px - 768px) */
    @media(max-width:768px){
      .wrap{padding:16px}
      h1{font-size:1.6em}
      h2{font-size:1.3em}
      .team span{max-width:160px;}
      table{font-size:13px}
      th,td{padding:6px}
    }
    
    /* Mobile devices (below 700px) */
    @media(max-width:700px){
      .twoCols{grid-template-columns:1fr;}
      .team span{max-width:140px;}
      .wrap{padding:12px}
      h1{font-size:1.5em;margin:.2em 0 .4em 0}
      h2{font-size:1.2em;margin:.2em 0 .4em 0}
      h3{font-size:1.1em}
      
      /* Touch-friendly buttons and inputs */
      input,select,button{
        padding:14px 12px;
        font-size:16px;
        min-height:48px; /* Better touch target - WCAG 2.1 guideline */
      }
      
      button{
        margin-top:8px;
        font-size:17px;
      }
      
      /* Card spacing */
      .card{
        padding:12px;
        margin-bottom:12px;
        border-radius:12px;
      }
      
      .miniCard{
        padding:8px;
        border-radius:10px;
      }
      
      /* Match header adjustments */
      .matchHead{
        flex-direction:column;
        gap:8px;
        text-align:center;
      }
      
      .team{
        justify-content:center;
        width:100%;
      }
      
      .logo{
        width:32px;
        height:32px; /* Larger logos on mobile */
      }
      
      .vs{
        font-size:14px;
        margin:4px 0;
      }
      
      /* Table responsive */
      .table-wrapper,table{
        font-size:12px;
        overflow-x:auto;
        -webkit-overflow-scrolling:touch;
      }
      
      table{
        display:block;
      }
      
      th,td{
        padding:8px 4px;
        white-space:nowrap;
      }
      
      /* Small text legibility */
      .small{
        font-size:14px;
        line-height:1.4;
      }
      
      .miniTitle{
        font-size:15px;
      }
    }
    
    /* Extra small devices (below 400px) */
    @media(max-width:400px){
      .wrap{padding:10px}
      h1{font-size:1.3em}
      h2{font-size:1.1em}
      
      .team span{
        max-width:100px;
        font-size:14px;
      }
      
      .logo{
        width:28px;
        height:28px;
      }
      
      input,select,button{
        padding:12px;
        font-size:15px;
      }
      
      .card{
        padding:10px;
        border-radius:10px;
      }
      
      table{font-size:11px}
      th,td{padding:6px 2px}
    }
    
    /* Landscape orientation on mobile */
    @media(max-height:500px) and (orientation:landscape){
      .wrap{padding:8px}
      h1{font-size:1.2em;margin:.1em 0 .3em 0}
      h2{font-size:1em;margin:.1em 0 .3em 0}
      .card{padding:8px;margin-bottom:8px}
      input,select,button{padding:10px}
    }
  </style>
</head>

<body>
<div class="wrap">

  <h1>‚öΩ Quiniela Liga MX</h1>

  <!-- REGISTRO -->
  <div class="card" id="registerCard">
    <h2>Reg√≠strate</h2>
    <div class="small">Tu nombre debe ser √∫nico (no se permiten repetidos)</div>
    <input id="regNombre" placeholder="Tu nombre">
    <div style="margin-top:10px">
      <button onclick="register()">Entrar</button>
    </div>
    <div id="regMsg" class="small" style="margin-top:8px"></div>
  </div>

  <!-- FORMULARIO -->
  <div class="card" id="formCard" style="display:none">
    <h2 id="jorTitle"></h2>
    <div class="small">Tienes <strong>2 pron√≥sticos</strong>. Cada uno compite por separado.</div>

    <!-- INFO DE PREMIOS -->
    <div style="margin-top:12px;padding:12px;background:rgba(255,255,255,.03);border:1px solid var(--line);border-radius:10px">
      <div class="small" style="line-height:1.6">
        <strong style="color:var(--ok)">üèÜ Premio Mayor:</strong> <span id="premioMayorMonto" style="color:var(--ok)">$0</span> - Quien acierte m√°s resultados (L/V/E). Si hay empate, se reparte.<br>
        <strong style="color:var(--accent)">ü•à Premio Menor:</strong> <span id="premioMenorMonto" style="color:var(--accent)">$0</span> - Quien acierte m√°s marcadores exactos. Sin empates (desempate: exactos ‚Üí aciertos ‚Üí primero en enviar).
      </div>
      <div id="prizePoolInfo" class="small" style="margin-top:8px;opacity:.7"></div>
    </div>

    <div id="picksBox" style="margin-top:10px"></div>

    <button style="margin-top:12px" onclick="submitAll()">Guardar pron√≥sticos</button>
    <div id="saveMsg" class="small" style="margin-top:8px"></div>

    <div style="margin-top:14px">
      <button class="secondary" onclick="openTabla()">üìä Ver tabla / transparencia</button>
    </div>
  </div>

  <!-- TABLA -->
  <div class="card" id="tablaCard" style="display:none">
    <h2>üìä Resultados</h2>
    <div id="premioMayorBox"></div>
    <div id="premioMenorBox"></div>

    <button class="secondary" style="margin-bottom:10px" onclick="loadTabla()">Ver tabla general</button>
    <button class="secondary" style="margin-bottom:10px" onclick="loadTransparencia()">üëÄ Ver todos los picks</button>

    <div id="tablaBox"></div>
  </div>

</div>

<script>
let SESSION = { token:null, jornada:null, lockMinutes:10, partidos:[] };

function esc(s){return String(s||"").replace(/[&<>"]/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[m]))}

/* ---------- TOKEN VALIDATION ---------- */
function validateTokenAndBootstrap(token){
  google.script.run
    .withSuccessHandler(loginR=>{
      if(!loginR || !loginR.ok){
        document.getElementById("regMsg").innerHTML = `<span class="bad">Error al validar: ${esc(loginR?.error || "desconocido")}</span>`;
        return;
      }
      document.getElementById("regMsg").innerHTML = `<span class="ok">‚úÖ Registro exitoso. Cargando predicciones...</span>`;
      bootstrap();
    })
    .withFailureHandler(err=>{
      document.getElementById("regMsg").innerHTML = `<span class="bad">Error de conexi√≥n: ${esc(err?.message || "intenta de nuevo")}</span>`;
    })
    .api_loginByToken(token);
}

/* ---------- REGISTRO ---------- */
function register(){
  const nombre = document.getElementById("regNombre").value.trim();
  if(!nombre) return;

  document.getElementById("regMsg").innerHTML = "Registrando‚Ä¶";

  google.script.run
    .withSuccessHandler(r=>{
      if(!r.ok){
        document.getElementById("regMsg").innerHTML = `<span class="bad">${esc(r.error)}</span>`;
        return;
      }
      SESSION.token = r.token;
      localStorage.setItem("q_token", r.token);
      validateTokenAndBootstrap(r.token);
    })
    .withFailureHandler(err=>{
      document.getElementById("regMsg").innerHTML = `<span class="bad">Error de conexi√≥n: ${esc(err?.message || "intenta de nuevo")}</span>`;
    })
    .api_register(nombre);
}

/* ---------- BOOTSTRAP ---------- */
function bootstrap(){
  const t = localStorage.getItem("q_token");
  if(t) SESSION.token = t;

  google.script.run
    .withSuccessHandler(r=>{
      if(!r || !r.ok){
        console.error("api_bootstrap failed:", r);
        document.getElementById("regMsg").innerHTML = `<span class="bad">No pude cargar la jornada.</span>`;
        return;
      }

      console.log("Bootstrap data:", r);
      SESSION.jornada = r.jornada;
      SESSION.lockMinutes = r.lockMinutes || 10;
      SESSION.partidos = r.partidos || [];

      console.log("Partidos loaded:", SESSION.partidos.length);

      // si no hay token, que se registre
      if(!SESSION.token){
        document.getElementById("registerCard").style.display = "block";
        document.getElementById("formCard").style.display = "none";
        return;
      }

      document.getElementById("registerCard").style.display = "none";
      document.getElementById("formCard").style.display = "block";
      document.getElementById("jorTitle").innerHTML = `Jornada ${r.jornada}`;

      renderForm();
      loadMyPicks();
      loadPrizePool();
    })
    .withFailureHandler(err=>{
      console.error("api_bootstrap error:", err);
      document.getElementById("regMsg").innerHTML = `<span class="bad">Error al cargar: ${esc(err?.message || "intenta recargar la p√°gina")}</span>`;
    })
    .api_bootstrap();
}

/* ---------- FORMULARIO ---------- */
function generateMatchKey(jornada, local, visit){
  return `${jornada}|${local}`.toLowerCase() + `|${visit}`.toLowerCase();
}

function loadMyPicks(){
  if(!SESSION.token || !SESSION.jornada) return;

  // Load picks for both entries
  loadPicksForEntry(1);
  loadPicksForEntry(2);
}

function loadPicksForEntry(entry){
  google.script.run
    .withSuccessHandler(r=>{
      if(r && r.ok && r.picks){
        fillPicksInForm(r.picks, entry);
      } else {
        console.warn(`No picks data for entry ${entry}:`, r);
      }
    })
    .withFailureHandler(err=>{
      console.error(`Error loading picks entry ${entry}:`, err);
    })
    .api_getMyPicks(SESSION.token, SESSION.jornada, entry);
}

function fillPicksInForm(picks, entry){
  SESSION.partidos.forEach((p, idx)=>{
    const key = generateMatchKey(SESSION.jornada, p.local, p.visit);
    const saved = picks[key];
    if(!saved) return;

    const pickEl = document.getElementById(`pick_${idx}_${entry}`);
    const marcEl = document.getElementById(`marc_${idx}_${entry}`);

    if(pickEl && saved.pick) pickEl.value = saved.pick;
    // Validate marcador values are present (can be numbers or numeric strings)
    if(marcEl && saved.gl != null && saved.gv != null && String(saved.gl).trim() !== "" && String(saved.gv).trim() !== ""){
      marcEl.value = `${saved.gl}-${saved.gv}`;
    }
  });
}

function renderForm(){
  const box = document.getElementById("picksBox");
  if(!SESSION.partidos.length){
    box.innerHTML = `<div class="small bad">No hay partidos cargados para esta jornada.</div>`;
    return;
  }

  let html = "";

  SESSION.partidos.forEach((p, idx)=>{
    const locked = !!p.locked;
    const lockBadge = locked
      ? `<div class="small bad">üîí Bloqueado (${esc(p.reason||"")})</div>`
      : `<div class="small ok">‚úÖ Abierto</div>`;

    html += `
      <div class="card ${locked ? "locked":""}">
        <div class="matchHead">
          <div class="team">
            ${p.logoLocal ? `<img class="logo" src="${esc(p.logoLocal)}" alt="">` : ``}
            <span><strong>${esc(p.local)}</strong></span>
          </div>
          <div class="vs">vs</div>
          <div class="team" style="justify-content:flex-end">
            <span><strong>${esc(p.visit)}</strong></span>
            ${p.logoVisit ? `<img class="logo" src="${esc(p.logoVisit)}" alt="">` : ``}
          </div>
        </div>

        <div class="small">${esc(p.fechaTxt||"")}</div>
        ${lockBadge}

        <div class="twoCols" style="margin-top:10px">
          <div class="miniCard">
            <div class="miniTitle">Pron√≥stico 1</div>
            <select id="pick_${idx}_1" ${locked ? "disabled":""}>
              <option value="">Pick</option>
              <option value="L">Local</option>
              <option value="E">Empate</option>
              <option value="V">Visitante</option>
            </select>
            <input id="marc_${idx}_1" ${locked ? "disabled":""} placeholder="Marcador (ej. 2-1)" style="margin-top:8px">
          </div>

          <div class="miniCard">
            <div class="miniTitle">Pron√≥stico 2</div>
            <select id="pick_${idx}_2" ${locked ? "disabled":""}>
              <option value="">Pick</option>
              <option value="L">Local</option>
              <option value="E">Empate</option>
              <option value="V">Visitante</option>
            </select>
            <input id="marc_${idx}_2" ${locked ? "disabled":""} placeholder="Marcador (ej. 2-1)" style="margin-top:8px">
          </div>
        </div>
      </div>
    `;
  });

  box.innerHTML = html;
}

/* ---------- SUBMIT (arreglado) ---------- */
function submitAll(){
  const saveMsg = document.getElementById("saveMsg");
  saveMsg.innerHTML = "Guardando‚Ä¶";

  const picks1 = [];
  const picks2 = [];

  SESSION.partidos.forEach((p, idx)=>{
    // entry 1
    let pick = (document.getElementById(`pick_${idx}_1`)?.value || "").trim();
    let marc = (document.getElementById(`marc_${idx}_1`)?.value || "").trim();
    let gl="", gv="";
    if(marc.includes("-")){
      const parts = marc.split("-");
      gl = (parts[0]||"").trim();
      gv = (parts[1]||"").trim();
    }
    picks1.push({ local:p.local, visit:p.visit, pick, gl, gv });

    // entry 2
    pick = (document.getElementById(`pick_${idx}_2`)?.value || "").trim();
    marc = (document.getElementById(`marc_${idx}_2`)?.value || "").trim();
    gl=""; gv="";
    if(marc.includes("-")){
      const parts = marc.split("-");
      gl = (parts[0]||"").trim();
      gv = (parts[1]||"").trim();
    }
    picks2.push({ local:p.local, visit:p.visit, pick, gl, gv });
  });

  // guardar entry 1
  google.script.run.withSuccessHandler(r1=>{
    if(!r1 || !r1.ok){
      saveMsg.innerHTML = `<span class="bad">‚õî Entry 1: ${esc(r1?.error || "error")}</span>`;
      return;
    }

    // guardar entry 2
    google.script.run.withSuccessHandler(r2=>{
      if(!r2 || !r2.ok){
        saveMsg.innerHTML = `<span class="bad">‚õî Entry 2: ${esc(r2?.error || "error")}</span>`;
        return;
      }

      saveMsg.innerHTML =
        `<span class="ok">‚úÖ Guardado: Entry 1 (${r1.created+r1.updated}) ¬∑ Entry 2 (${r2.created+r2.updated})</span>
         <div class="small">Bloqueados por lock: ${ (r1.blocked||0) + (r2.blocked||0) }</div>`;

    }).api_submit({ token:SESSION.token, jornada:SESSION.jornada, entry:2, picks:picks2 });

  }).api_submit({ token:SESSION.token, jornada:SESSION.jornada, entry:1, picks:picks1 });
}

/* ---------- PRIZE POOL ---------- */
function loadPrizePool(){
  google.script.run.withSuccessHandler(r=>{
    if(!r || !r.ok) return;
    
    const premioMayorEl = document.getElementById("premioMayorMonto");
    const premioMenorEl = document.getElementById("premioMenorMonto");
    const infoEl = document.getElementById("prizePoolInfo");
    
    if(premioMayorEl) premioMayorEl.innerHTML = `$${r.premioMayor.toLocaleString()}`;
    if(premioMenorEl) premioMenorEl.innerHTML = `$${r.premioMenor.toLocaleString()}`;
    
    if(infoEl && r.jugadoresPagados > 0){
      infoEl.innerHTML = `${r.jugadoresPagados} participante${r.jugadoresPagados > 1 ? 's' : ''} ¬∑ Bolsa total: $${r.poolPremios.toLocaleString()}`;
    } else if(infoEl) {
      infoEl.innerHTML = `Esperando participantes...`;
    }
  }).api_getPrizePool();
}

/* ---------- TABLA / TRANSPARENCIA ---------- */
function openTabla(){
  document.getElementById("tablaCard").style.display = "block";
  loadPremioMayor();
  loadPremioMenor();
  loadTabla();
}

function loadPremioMayor(){
  const box = document.getElementById("premioMayorBox");
  box.innerHTML = "";

  google.script.run.withSuccessHandler(r=>{
    if(!r || !r.ok){
      box.innerHTML = `<div class="small bad">üèÜ Premio mayor: ${esc(r?.error || "No disponible (cierra la jornada)")}</div>`;
      return;
    }
    if(!r.winners || !r.winners.length){
      box.innerHTML = `<div class="small">üèÜ Premio mayor: (sin datos)</div>`;
      return;
    }
    
    const ganadores = r.winners.map(w => `${esc(w.nombre)} (Entry ${esc(w.entry)})`).join(', ');
    const compartido = r.winners.length > 1 ? ` <span class="small">(premio compartido)</span>` : '';
    
    box.innerHTML = `
      <div class="card" style="background:rgba(53,212,154,.1);border-color:#35d49a;margin-bottom:10px">
        üèÜ <strong>Premio Mayor - M√°s Aciertos</strong>${compartido}<br>
        Ganador${r.winners.length > 1 ? 'es' : ''}: <strong>${ganadores}</strong><br>
        Aciertos: <strong>${esc(r.maxAciertos)}</strong><br>
        <div class="small" style="margin-top:6px;opacity:.9">Premio al que tenga m√°s aciertos en resultados (L/V/E). Si hay empate, se reparte el premio.</div>
      </div>
    `;
  }).api_getPremioMayor(SESSION.jornada);
}

function loadPremioMenor(){
  const box = document.getElementById("premioMenorBox");
  box.innerHTML = "";

  google.script.run.withSuccessHandler(r=>{
    if(!r || !r.ok){
      box.innerHTML = `<div class="small bad">ü•à Premio menor: ${esc(r?.error || "No disponible (cierra la jornada)")}</div>`;
      return;
    }
    if(!r.winner){
      box.innerHTML = `<div class="small">ü•à Premio menor: (sin datos)</div>`;
      return;
    }
    box.innerHTML = `
      <div class="card" style="background:rgba(124,156,255,.1);border-color:#7c9cff;margin-bottom:10px">
        ü•à <strong>Premio Menor - Marcadores Exactos</strong><br>
        Ganador: <strong>${esc(r.winner.nombre)} (Entry ${esc(r.winner.entry)})</strong><br>
        Exactos: <strong>${esc(r.winner.exactos)}</strong> ¬∑ Aciertos: <strong>${esc(r.winner.aciertos)}</strong><br>
        <div class="small" style="margin-top:6px;opacity:.9">Premio menor a quien tenga m√°s aciertos en marcadores exactos. No hay empates.<br>Desempate: exactos ‚Üí aciertos ‚Üí primero en enviar.</div>
      </div>
    `;
  }).api_getPremioMarcadorExactoPorEntry(SESSION.jornada);
}

function loadTabla(){
  const box = document.getElementById("tablaBox");
  box.innerHTML = `<div class="small">Cargando tabla‚Ä¶</div>`;

  google.script.run.withSuccessHandler(r=>{
    if(!r || !r.ok){
      box.innerHTML = `<div class="small bad">‚õî ${esc(r?.error || "No disponible")}</div>`;
      return;
    }

    let html = `<table><thead><tr><th>#</th><th>Entry</th><th>Nombre</th><th class="center">Pts</th></tr></thead><tbody>`;
    (r.rows||[]).forEach(x=>{
      html += `<tr>
        <td>${x.pos}</td>
        <td class="center">${esc(x.entry)}</td>
        <td>${esc(x.nombre)}</td>
        <td class="center"><strong>${esc(x.puntos)}</strong></td>
      </tr>`;
    });
    html += `</tbody></table>`;

    box.innerHTML = html;
  }).api_getTablaGeneral();
}

function loadTransparencia(){
  const box = document.getElementById("tablaBox");
  box.innerHTML = `<div class="small">Cargando transparencia‚Ä¶</div>`;

  google.script.run.withSuccessHandler(r=>{
    if(!r || !r.ok){
      box.innerHTML = `<div class="small bad">‚õî ${esc(r?.error || "No disponible (cierra la jornada)")}</div>`;
      return;
    }

    let html = `<div class="small" style="margin-bottom:10px">Transparencia ‚Äî Jornada ${esc(r.jornada)}</div>`;

    (r.rows||[]).forEach(u=>{
      html += `
        <div class="card" style="background:rgba(255,255,255,.03)">
          <div style="font-weight:900;margin-bottom:8px">
            ${esc(u.nombre)} ‚Äî Entry ${esc(u.entry)}
          </div>

          <div style="overflow:auto">
            <table>
              <thead>
                <tr>
                  <th>Partido</th>
                  <th class="center">Pick</th>
                  <th class="center">Marcador</th>
                  <th class="center">Real</th>
                </tr>
              </thead>
              <tbody>
                ${(u.picks||[]).map(p=>`
                  <tr>
                    <td>${esc(p.local)} vs ${esc(p.visit)}</td>
                    <td class="center"><strong>${esc(p.pick || "‚Äî")}</strong></td>
                    <td class="center">${esc(p.pickMarc || "‚Äî")}</td>
                    <td class="center">${esc(p.marcadorReal || "‚Äî")}</td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          </div>
        </div>
      `;
    });

    box.innerHTML = html;
  }).api_getTransparenciaPicks(SESSION.jornada);
}

/* ---------- AUTO ---------- */
window.onload = bootstrap;
</script>
</body>
</html>
